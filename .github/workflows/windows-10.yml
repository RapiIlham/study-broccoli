name: Windows QEMU Installation

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install QEMU
      run: |
        sudo apt-get update
        sudo apt-get install -y qemu-system-x86 p7zip-full wget
        sudo wget --quiet https://archive.org/download/windows-10-22h2-x64-english/en-us_windows_10_22h2_updated_may_2023_x64_dvd_8ae93bf4.iso
        ls

    - name: Download Windows ISO
      uses: actions/download-artifact@v2
      with:
        name: windows-iso

    - name: Create virtual machine
      run: |
        qemu-img create -f qcow2 windows.qcow2 120G
        qemu-system-x86_64 -m 10G -smp 4 -boot d -cdrom ${{ github.event.inputs.iso_url }} -drive if=none,file=windows.qcow2,id=hd -device virtio-blk-device,drive=hd -enable-kvm
