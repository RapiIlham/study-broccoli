name: Windows QEMU Installation

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - run: ls ~/work/study-broccoli

    - name: Install QEMU
      run: |
        sudo apt-get update
        sudo apt-get install -y qemu-system-x86 p7zip-full wget
        sudo wget https://software.download.prss.microsoft.com/dbazure/Win10_22H2_English_x64v1.iso?t=ca7b2b88-fc61-4a4c-99d8-620e9a842165&P1=1710052793&P2=601&P3=2&P4=sKTy7R0OjS2f0jwcYymWUxAV7qd2GbZg2PgsJEPWm4ySfuBXUPXlkIjVn27CMj29zpyuuEwpVruAj%2foC5Z238lhJVYZuRqt95aNKEAouRr%2f2F7vrdOzl0URXCC97RS3qKO%2bLvUUXNDVhrxkMgOBwU%2bMarnRMGXh1yWDa7UIGlCHllQk3k2BID%2fe7uTsInqM12qzwTT9VSUbkZP4YJOxhraLJsm74T%2bQrjWDmViKPsqPr0h%2fNigZZyFdQGLDNucovoRmg3Mou59juYftj2oKktJ8nKpMkIJF20zVhCbBnl0fn1atyJVyxHFhT%2bkpf47M9bRTiSPB2WR3wDKhEnePkkg%3d%3d
    - run: mv Win10_22H2_English_x64v1.iso?t=ca7b2b88-fc61-4a4c-99d8-620e9a842165 win10.iso
    - name: Cache Gradle packages
      uses: actions/cache@v3
      with:
        path: ~/work/study-broccoli/study-broccoli/win10.iso
        key: Linux-files--9e3040381aeb0f19c85388452d9867ffbe1185e361894e07172f9b38afdd2609
        restore-keys: Linux-files--9e3040381aeb0f19c85388452d9867ffbe1185e361894e07172f9b38afdd2609

    # - name: Create virtual machine
    #   run: |
    #     qemu-img create -f qcow2 windows.qcow2 120G
    #     qemu-system-x86_64 -m 10G -smp 4 -boot d -cdrom ${{ github.event.inputs.iso_url }} -drive if=none,file=windows.qcow2,id=hd -device virtio-blk-device,drive=hd -enable-kvm
